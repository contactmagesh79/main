name: Snowflake Direct Deploy

on:
push:
branches: [ "main" ]

jobs:
snowflake-task:
runs-on: ubuntu-latest

# Ensure these are set in Settings > Secrets and variables > Actions
env:
SN_USER: ${{ secrets.SNOWFLAKE_USER }}
SN_PASS: ${{ secrets.SNOWFLAKE_PASSWORD }}
SN_ACCT: ${{ secrets.SNOWFLAKE_ACCOUNT }}

steps:
- name: Setup Python
uses: actions/setup-python@v4
with:
python-version: '3.9'

- name: Install Connector
run: pip install snowflake-connector-python

- name: Run Inline Python Script
shell: python
run: |
import snowflake.connector
import os

# Connect using environment variables
conn = snowflake.connector.connect(
user=os.getenv('SN_USER'),
password=os.getenv('SN_PASS'),
account=os.getenv('SN_ACCT'),
warehouse='COMPUTE_WH', # Replace with your WH
database='DEMO_DB', # Replace with your DB
schema='PUBLIC' # Replace with your Schema
)

try:
conn.cursor().execute("CREATE TABLE IF NOT EXISTS SIMPLE_TABLE (COL1 STRING)")
print("Success: Table created.")
finally:
conn.close()
